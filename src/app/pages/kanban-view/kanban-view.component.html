<div class="page-container">
  <header class="page-header">
    <div class="header-content">
      <button class="back-button" (click)="goHome()">
        ‚Üê Volver
      </button>
      <div class="header-title">
        <h1>Timeline Kanban</h1>
        <p class="subtitle">Plan de Despliegue ‚Äî Tablero de estado por columnas</p>
      </div>
    </div>
  </header>

  <!-- Dashboard de M√©tricas -->
  <div class="metrics-dashboard">
    <div class="metric-card total">
      <div class="metric-number">{{ totalTasks() }}</div>
      <div class="metric-label">TOTAL TAREAS</div>
    </div>
    <div class="metric-card completed">
      <div class="metric-number">{{ completedTasks().length }}</div>
      <div class="metric-label">COMPLETADAS</div>
    </div>
    <div class="metric-card in-progress">
      <div class="metric-number">{{ inProgressTasks().length }}</div>
      <div class="metric-label">EN PROGRESO</div>
    </div>
    <div class="metric-card pending">
      <div class="metric-number">{{ pendingTasks().length }}</div>
      <div class="metric-label">PENDIENTES</div>
    </div>
    <div class="metric-card priority">
      <div class="metric-number">{{ highPriorityTasks() }}</div>
      <div class="metric-label">ALTA PRIORIDAD</div>
    </div>
  </div>

  <!-- Barra de Progreso General -->
  <div class="overall-progress">
    <div class="progress-info">
      <span>Progreso general: {{ overallProgress() }}% completado</span>
    </div>
    <div class="progress-bar-main">
      <div class="progress-bar-fill" [style.width.%]="overallProgress()"></div>
    </div>
  </div>

  <!-- Toolbar -->
  <div class="toolbar">
    <div class="toolbar-group">
      <button class="toolbar-btn secondary" (click)="exportData()">
        Exportar imagen
      </button>
      <button class="toolbar-btn" (click)="downloadExample()">
        üì• Plantilla
      </button>
      <label class="toolbar-btn file-label">
        üì§ Cargar CSV
        <input
          type="file"
          accept=".csv,.xlsx,.xls"
          (change)="onFileSelected($event)"
          hidden
        />
      </label>
    </div>
  </div>

  <!-- Kanban Board -->
  <div class="kanban-board">
    <!-- Columna Completadas -->
    <div class="kanban-column completed-column">
      <div class="column-header">
        <div class="column-title">
          <span class="check-icon">‚úì</span>
          <h2>Completadas</h2>
        </div>
        <span class="task-count">{{ completedTasks().length }}</span>
      </div>
      <div class="tasks-container">
        @for (task of completedTasks(); track task.id) {
          <div class="task-card completed">
            <div class="task-title-row">
              <h3>{{ task.title }}</h3>
            </div>
            <div class="task-meta">
              <span class="task-week">{{ getWeekLabel(task) }}: {{ formatDateRange(task) }}</span>
              <span class="task-subtasks">{{ getSubtaskCount(task) }} elementos</span>
            </div>
            <div class="task-status-message">
              <span class="status-icon">‚úì</span>
              <span>Finalizada con √©xito. Objetivos cumplidos satisfactoriamente.</span>
            </div>
            <div class="task-priority-tag" [class]="'priority-' + task.priority">
              PRIORIDAD {{ getPriorityLabel(task.priority).toUpperCase() }}
            </div>
          </div>
        }
        @if (completedTasks().length === 0) {
          <p class="empty-message">No hay tareas completadas</p>
        }
      </div>
    </div>

    <!-- Columna En Progreso -->
    <div class="kanban-column progress-column">
      <div class="column-header">
        <div class="column-title">
          <span class="progress-icon">‚óê</span>
          <h2>En progreso</h2>
        </div>
        <span class="task-count">{{ inProgressTasks().length }}</span>
      </div>
      <div class="tasks-container">
        @for (task of inProgressTasks(); track task.id) {
          <div class="task-card in-progress">
            <div class="task-title-row">
              <h3>{{ task.title }}</h3>
            </div>
            <div class="task-meta">
              <span class="task-week">{{ getWeekLabel(task) }}: {{ formatDateRange(task) }}</span>
              <span class="task-subtasks">{{ getSubtaskCount(task) }} elementos</span>
            </div>
            <div class="task-progress-bar">
              <div class="task-progress-fill" [style.width.%]="task.progress"></div>
              <span class="progress-percentage">{{ task.progress }}%</span>
            </div>
            <div class="task-status-message">
              <span class="status-icon">‚óê</span>
              <span>En desarrollo. {{ task.assignee }} trabajando activamente.</span>
            </div>
            <div class="task-priority-tag" [class]="'priority-' + task.priority">
              PRIORIDAD {{ getPriorityLabel(task.priority).toUpperCase() }}
            </div>
          </div>
        }
        @if (inProgressTasks().length === 0) {
          <p class="empty-message">No hay tareas en progreso</p>
        }
      </div>
    </div>

    <!-- Columna Pendientes -->
    <div class="kanban-column pending-column">
      <div class="column-header">
        <div class="column-title">
          <span class="pending-icon">‚óã</span>
          <h2>Pendientes</h2>
        </div>
        <span class="task-count">{{ pendingTasks().length }}</span>
      </div>
      <div class="tasks-container">
        @for (task of pendingTasks(); track task.id) {
          <div class="task-card pending">
            <div class="task-title-row">
              <h3>{{ task.title }}</h3>
            </div>
            <div class="task-meta">
              <span class="task-week">{{ getWeekLabel(task) }}: {{ formatDateRange(task) }}</span>
              <span class="task-subtasks">{{ getSubtaskCount(task) }} elementos</span>
            </div>
            <div class="task-status-message">
              <span class="status-icon">‚óã</span>
              <span>Programada. Asignado a {{ task.assignee }}.</span>
            </div>
            <div class="task-priority-tag" [class]="'priority-' + task.priority">
              PRIORIDAD {{ getPriorityLabel(task.priority).toUpperCase() }}
            </div>
          </div>
        }
        @if (pendingTasks().length === 0) {
          <p class="empty-message">No hay tareas pendientes</p>
        }
      </div>
    </div>
  </div>
</div>
